subtree æ˜¯ git åŸç”Ÿæä¾›çš„åŠŸèƒ½ï¼Œä¸éœ€è¦å®‰è£ä»»ä½•é¡å¤–çš„å¤–æ›æˆ–æ“´å……ã€‚å®ƒæ˜¯ git çš„ä¸€å€‹å…§å»ºå­å‘½ä»¤ï¼Œä¸»è¦ç”¨æ–¼ç®¡ç†å¤šå€‹å°ˆæ¡ˆä¹‹é–“çš„é—œä¿‚ï¼Œç‰¹åˆ¥é©åˆä½ é€™ç¨®éœ€è¦åœ¨ä¸€å€‹å€‰åº«ä¸­ç®¡ç†å¦ä¸€å€‹å€‰åº«å…§å®¹çš„æƒ…æ³

git subtree å¤§ç´„åœ¨ git 1.7.11 ç‰ˆæœ¬å°±è¢«åŠ å…¥äº†ï¼Œæ‰€ä»¥åœ¨ç¾ä»£çš„ git ç‰ˆæœ¬ä¸­éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å®ƒçš„å®Œæ•´å‘½ä»¤æ ¼å¼æ˜¯ï¼š
```bash
git subtree add|merge|pull|push [--prefix=<prefix>] [<repository> [<ref>]]
```

subtree ç›¸æ¯” submodule çš„å„ªé»æ˜¯ï¼š
- ä¸éœ€è¦åœ˜éšŠå…¶ä»–æˆå“¡å­¸ç¿’æ–°çš„å‘½ä»¤ï¼Œå°ä»–å€‘ä¾†èªªä»ç„¶æ˜¯æ™®é€šçš„ git æ“ä½œ
- å­å°ˆæ¡ˆçš„æ­·å²è¨˜éŒ„ç›´æ¥æ•´åˆåˆ°ä¸»å°ˆæ¡ˆä¸­
- ä¸æœƒç”¢ç”Ÿ .gitmodules æ–‡ä»¶åŠé¡å¤–çš„ç®¡ç†è² æ“”
- å³ä½¿æ²’æœ‰ç¶²è·¯é€£æ¥ï¼Œä¹Ÿèƒ½æŸ¥çœ‹å’Œä¿®æ”¹å­å°ˆæ¡ˆçš„å…§å®¹

å¯ä»¥é€šéä»¥ä¸‹å‘½ä»¤ä¾†ç¢ºèªä½ çš„ git æ˜¯å¦æ”¯æ´ subtreeï¼š
```bash
git subtree -h
```
### - å¯¦éš›æ“ä½œ (split æ–¹æ³•)

```
ä¸»å€‰åº«    â†’  split åˆ†é›¢   â†’  æ¨é€åˆ°é ç«¯ repo
â†“               â†“             â†“
å®Œæ•´æ­·å²  â†’  å­è³‡æ–™å¤¾æ­·å²  â†’   åœ˜éšŠ repo
```

ä½ éœ€è¦åœ¨ä¸»è³‡æ–™å¤¾ï¼ˆå·²ç¶“ä½¿ç”¨ git init åˆå§‹åŒ–çš„é‚£å€‹ç­†è¨˜è³‡æ–™å¤¾ï¼‰ä¸­æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨å­è³‡æ–™å¤¾ä¸­ã€‚git subtree å‘½ä»¤æ˜¯å¾ä¸»å€‰åº«çš„è§’åº¦ä¾†ç®¡ç†å­è³‡æ–™å¤¾çš„ã€‚å…·é«”æ­¥é©Ÿå¦‚ä¸‹ï¼š

1. ç¢ºä¿åœ¨ä¸»ç­†è¨˜è³‡æ–™å¤¾ï¼ˆå·²ç¶“ git init çš„é‚£å€‹ï¼‰çš„æ ¹ç›®éŒ„ï¼š
```bash
cd ä¸»ç­†è¨˜è³‡æ–™å¤¾è·¯å¾‘
```

2. ä½¿ç”¨ subtree split å°‡å­è³‡æ–™å¤¾çš„æ­·å²åˆ†é›¢å‡ºä¾†ï¼š
```bash
git subtree split --prefix=å­è³‡æ–™å¤¾åç¨± -b split-branch
```

é€™æœƒ (split) å»ºç«‹ä¸€å€‹æ–°çš„åˆ†æ”¯ï¼ŒåªåŒ…å«è©²å­è³‡æ–™å¤¾çš„æ­·å²è¨˜éŒ„ã€‚é€™å€‹ä¸»è¦æ˜¯åœ¨åšæœ¬åœ°åˆ†æ”¯çš„æ¨é€²ï¼ˆæ›´æ–°ï¼‰ï¼Œä»–çš„ä½œç”¨æ˜¯ï¼š
- åˆ†æä¸»åˆ†æ”¯çš„æ­·å²è¨˜éŒ„ï¼Œæ‰¾å‡ºæ‰€æœ‰èˆ‡æŒ‡å®šå­è³‡æ–™å¤¾ç›¸é—œçš„è®Šæ›´
- å‰µå»ºä¸€å€‹æ–°çš„æäº¤åºåˆ—ï¼ŒåªåŒ…å«è©²å­è³‡æ–™å¤¾çš„è®Šæ›´æ­·å²
- å°‡é€™å€‹ä¹¾æ·¨çš„æäº¤åºåˆ—å„²å­˜åˆ° `split-branch` åˆ†æ”¯ä¸Š
- å¦‚æœåˆ†æ”¯**å·²å­˜åœ¨å‰‡æœƒæ›´æ–°å®ƒ**ï¼Œé€™å°±æ˜¯ã€Œæœ¬åœ°åˆ†æ”¯çš„æ¨é€²ã€

é€™å€‹æ“ä½œå®Œå…¨åœ¨æœ¬åœ°é€²è¡Œï¼Œä¸èˆ‡ä»»ä½•é ç«¯å„²å­˜åº«äº’å‹•ã€‚å®ƒæœƒæº–å‚™å¥½ä¸€å€‹ä¹¾æ·¨çš„åˆ†æ”¯ï¼Œè€Œé€™å€‹åˆ†æ”¯åªåŒ…å«å­è³‡æ–™å¤¾ç›¸é—œçš„æ­·å²ï¼Œæ–¹ä¾¿å¾ŒçºŒæ¨é€åˆ°é ç«¯

3. æ·»åŠ  GitLab çš„é ç«¯å€‰åº«ï¼š
```bash
git remote add gitlab https://gitlab.com/team/project.git
```

4. å°‡åˆ†é›¢å‡ºä¾†çš„åˆ†æ”¯æ¨é€åˆ° GitLabï¼š
```bash
git push gitlab split-branch-name:main
```

æ‰€ä»¥æ•´å€‹å·¥ä½œæµç¨‹æ˜¯ï¼š
1. ä½¿ç”¨ `git subtree split` æ›´æ–°æˆ–å‰µå»º split-branch
2. ä½¿ç”¨ `git push` å°‡é€™å€‹åˆ†æ”¯æ¨é€åˆ°é ç«¯

é€™æ¨£å°±å¯ä»¥ï¼š
- æ­£å¸¸ç¶­è­·å€‹äººçš„ç­†è¨˜
- åªå°‡ç‰¹å®šå­è³‡æ–™å¤¾åŒæ­¥åˆ°åœ˜éšŠçš„ GitLab

ğŸª„ å†æ¬¡æé†’æ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨ä¸»è³‡æ–™å¤¾ä¸­é€²è¡Œçš„ï¼Œ**ä¸éœ€è¦**åˆ°å­è³‡æ–™å¤¾ä¸­æ“ä½œã€‚å¦å¤–å¯ä»¥é€éé€™å€‹æŒ‡ä»¤æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ç›®å‰çš„æ¨é€æƒ…æ³ï¼š
```bash
PS C:\Users\Frank\æ–‡ä»¶\CS_SE_vault> git branch -vv
* main         64a0801 [origin/main] feat: add new postgresql notes
  split-branch c052671 feat: update fhir validator
```

å¸¸è¦‹å•é¡Œï¼š
Qï¼šå¦‚æœå­è³‡æ–™å¤¾åœ¨ä¸»å€‰åº«ä¸­æœ‰ä¿®æ”¹ï¼Œå¦‚ä½•åŒæ­¥åˆ°é ç«¯ï¼Ÿ
Aï¼šé‡æ–°åŸ·è¡Œ `git subtree split` å’Œ `git push` å³å¯ï¼ŒGit æœƒè‡ªå‹•è™•ç†å¢é‡æ›´æ–°

#### è¼¸å‡º
```powershell
PS C:\Users\Frank\Documents\CS_SE_vault> git subtree split --prefix=FHIR -b fhirtogitlab
66/89 (65) [0]

66/89 (65) [0]
â”‚  â”‚   â”‚   â””â”€â”€ éŒ¯èª¤æˆ–è¡çªè¨ˆæ•¸ (å¯èƒ½æ˜¯)
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€ ç•¶å‰è™•ç†çš„ commit ç·¨è™Ÿ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç¸½å…±éœ€è¦æª¢æŸ¥çš„ commit æ•¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å·²æª¢æŸ¥çš„ commit æ•¸

# é©—è­‰ç¸½ commit æ•¸
git rev-list --count HEAD

# æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ç‹€æ³
git branch -vv

# æª¢æŸ¥é ç«¯åŒæ­¥ç‹€æ…‹
git ls-remote gitlab main
```
- **æ­·å²éæ­·**ï¼šGit æ­£åœ¨æª¢æŸ¥ä¸»åˆ†æ”¯çš„ 89 å€‹ commit
- **è·¯å¾‘éæ¿¾**ï¼šåˆ¤æ–·æ¯å€‹ commit æ˜¯å¦åŒ…å«å° `FHIR` è³‡æ–™å¤¾çš„è®Šæ›´
- **åˆ†æ”¯æ§‹å»º**ï¼šå°‡ç›¸é—œçš„ commit é‡æ–°çµ„ç¹”æˆæ–°çš„æäº¤åºåˆ—
- **å¢é‡åˆ¤æ–·**ï¼šæ¯”è¼ƒèˆ‡ç¾æœ‰ `fhirtogitlab` åˆ†æ”¯çš„å·®ç•°

#### é€²éšç”¨æ³•ï¼š--rejoin åƒæ•¸
```bash
git subtree split --prefix=FHIR --rejoin -b fhir-split
```
æ³¨æ„ï¼šä½¿ç”¨ --rejoin æœƒåœ¨ä¸»åˆ†æ”¯ç”¢ç”Ÿé¡å¤–çš„ merge commit

`--rejoin` çš„ä½œç”¨ï¼š
- åœ¨ä¸»åˆ†æ”¯ä¸­å‰µå»ºä¸€å€‹ merge commitï¼Œè¨˜éŒ„é€™æ¬¡ split çš„æ“ä½œ
- å¹«åŠ© Git æ›´å¥½åœ°è¿½è¹¤ subtree çš„æ­·å²é—œä¿‚
- æå‡å¾ŒçºŒ split æ“ä½œçš„æ•ˆèƒ½ï¼ˆGit çŸ¥é“å¾å“ªè£¡é–‹å§‹å¢é‡è™•ç†ï¼‰
- é©åˆéœ€è¦é »ç¹åŒæ­¥çš„æƒ…æ³
### - ç›´æ¥ push çš„æ–¹æ³•

ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `git subtree push` ä¸€æ­¥å®Œæˆï¼Œè·³é split-branch çš„å‰µå»ºå’Œæ›´æ–°ï¼š
```bash
git subtree push --prefix=å­è³‡æ–™å¤¾åç¨± <local ç«¯çš„ remote name> <remote ç«¯çš„æ”¯ç·šåç¨±>
```

`git subtree push`æœƒåœ¨å…§éƒ¨å‰µå»ºæš«æ™‚åˆ†æ”¯ï¼Œç•¶åŸ·è¡Œ `git subtree push --prefix=fhir gitlab main` æ™‚ï¼š

1. **Git æœƒæª¢æŸ¥ä¸Šæ¬¡çš„ split è¨˜éŒ„**
   - Git æœƒåœ¨ `.git/subtree-cache` ä¸­å°‹æ‰¾ä¹‹å‰çš„ split è¨˜éŒ„
   - å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ subtree é…ç½®ï¼Œæœƒå˜—è©¦é‡ç”¨ä¹‹å‰çš„ commit hash

2. **å¢é‡è™•ç†**
   - åªæœƒç‚ºã€Œæ–°å¢çš„ã€è®Šæ›´å‰µå»ºæ–°çš„ commit
   - ä¸æœƒé‡æ–°ç”Ÿæˆæ•´å€‹æ­·å²ç·š

3. **æš«æ™‚åˆ†æ”¯è‡ªå‹•æ¸…ç†**
   - æ¨é€å®Œæˆå¾Œè‡ªå‹•åˆªé™¤æš«æ™‚åˆ†æ”¯
   - ä¸æœƒåœ¨æœ¬åœ°ç•™ä¸‹å¤šé¤˜çš„åˆ†æ”¯